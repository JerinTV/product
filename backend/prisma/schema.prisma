// ============================================
// GENERATOR & DATABASE
// ============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER (Auth System)
// ============================================

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      String   // manufacturer | retailer | admin
  createdAt DateTime @default(now())
}

// ============================================
// PRODUCT SECRET (NFC / Blockchain Challenge)
// ============================================

model ProductSecret {
  id        Int      @id @default(autoincrement())
  productId String   @unique
  secret    String
  createdAt DateTime @default(now())
}

// ============================================
// BATCH MODEL
// ============================================

model Batch {
  id               Int       @id @default(autoincrement())
  batchId          String    @unique
  boxId            String
  batchSize        Int

  manufacturer     String
  manufacturerDate String
  manufacturePlace String

  modelNumber      String
  color            String
  price            BigInt

  shipped          Boolean   @default(false)

  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  products         Product[]

  activities       Activity[]
}

// ============================================
// PRODUCT MODEL
// ============================================

model Product {
  id               Int       @id @default(autoincrement())
  productId        String    @unique

  boxId            String
  name             String
  category         String

  manufacturer     String
  manufacturerDate String
  manufacturePlace String

  modelNumber      String
  serialNumber     String
  warrantyPeriod   String

  batchNumber      String
  color            String
  specs            String

  price            BigInt
  image            String

  shipped          Boolean   @default(false)
  verified         Boolean   @default(false)
  sold             Boolean   @default(false)

  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  batch            Batch     @relation(fields: [batchNumber], references: [batchId], onDelete: Cascade)
}

// ============================================
// ACTIVITY LOG (For Premium Dashboard)
// ============================================

model Activity {
  id        Int      @id @default(autoincrement())
  message   String
  type      String   // REGISTER | SHIP | VERIFY | SELL
  batchId   String?
  createdAt DateTime @default(now())

  batch     Batch?   @relation(fields: [batchId], references: [batchId])
}